filter {
  # 1. Translate experiment_id to experiment_name
  if [meta][experiment_id] {
    translate {
      field => "[meta][experiment_id]"
      destination => "[meta][experiment]"
      dictionary_path => "/etc/stardust/pipeline/experiments_map.yml"
      fallback => "Unknown" # Optional: Value if no match
    }
  }

  # 2. If both experiment_id and activity_id exist, create a composite key
  if [meta][experiment_id] and [meta][activity_id] {
    mutate {
      # Creates a temporary field with the composite key, e.g., "1_3"
      add_field => { "[@metadata][temp_composite_activity_key]" => "%{[meta][experiment_id]}_%{[meta][activity_id]}" }
    }

    # 3. Translate the composite key to activity_name
    translate {
      field => "[@metadata][temp_composite_activity_key]"
      destination => "[meta][activity]"
      dictionary_path => "/etc/stardust/pipeline/activities_map.yml" # UPDATE THIS PATH
      fallback => "Unknown" # Optional: Value if no match
    }
  }
}
